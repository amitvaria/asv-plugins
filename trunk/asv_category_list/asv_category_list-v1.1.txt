# asv_category_list v1.1
# Extends the functionality of category_list
# Amit Varia
# http://www.amitvaria.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTc6ImFzdl9jYXRlZ29yeV9saXN0IjtzOjc6InZlcnNpb24i
O3M6MzoiMS4xIjtzOjY6ImF1dGhvciI7czoxMDoiQW1pdCBWYXJpYSI7czoxMDoiYXV0aG9y
X3VyaSI7czoyNToiaHR0cDovL3d3dy5hbWl0dmFyaWEuY29tLyI7czoxMToiZGVzY3JpcHRp
b24iO3M6NDI6IkV4dGVuZHMgdGhlIGZ1bmN0aW9uYWxpdHkgb2YgY2F0ZWdvcnlfbGlzdCI7
czo0OiJ0eXBlIjtpOjA7czo0OiJoZWxwIjtzOjIzOiJoMS4gYXN2X2NhdGVnb3J5X2xpc3QK
CiI7czo0OiJjb2RlIjtzOjIxNzk6ImZ1bmN0aW9uIGFzdl9jYXRlZ29yeV9saXN0KCRhdHRz
KSB7CglnbG9iYWwgJHMsICRjOwoKCWV4dHJhY3QobEF0dHMoYXJyYXkoCgkJJ2FjdGl2ZV9j
bGFzcycgPT4gJycsCgkJJ2JyZWFrJyAgICAgICAgPT4gYnIsCgkJJ2NhdGVnb3JpZXMnICAg
PT4gJycsCgkJJ2NsYXNzJyAgICAgICAgPT4gX19GVU5DVElPTl9fLAoJCSdleGNsdWRlJyAg
ICAgID0+ICcnLAoJCSdsYWJlbCcgICAgICAgID0+ICcnLAoJCSdsYWJlbHRhZycgICAgID0+
ICcnLAoJCSdwYXJlbnQnICAgICAgID0+ICcnLAoJCSdzZWN0aW9uJyAgICAgID0+ICcnLAoJ
CSd0aGlzX3NlY3Rpb24nID0+IDAsCgkJJ3R5cGUnICAgICAgICAgPT4gJ2FydGljbGUnLAoJ
CSd3cmFwdGFnJyAgICAgID0+ICcnLAoJCSdhY3RpdmVjYXRlZ29yaWVzJyA9PiAnbicsCgkp
LCAkYXR0cykpOwoKCWlmICgkY2F0ZWdvcmllcykgewoJCSRjYXRlZ29yaWVzID0gZG9fbGlz
dCgkY2F0ZWdvcmllcyk7CgkJJGNhdGVnb3JpZXMgPSBqb2luKCInLCciLCBkb1NsYXNoKCRj
YXRlZ29yaWVzKSk7CgoJCSRycyA9IHNhZmVfcm93c19zdGFydCgnbmFtZSwgdGl0bGUnLCAn
dHhwX2NhdGVnb3J5JywKCQkidHlwZSA9ICciLmRvU2xhc2goJHR5cGUpLiInIGFuZCBuYW1l
IGluICgnJGNhdGVnb3JpZXMnKSBvcmRlciBieSBmaWVsZChuYW1lLCAnJGNhdGVnb3JpZXMn
KSIpOwoJfQoKCWVsc2UgewoJCWlmICgkZXhjbHVkZSkgewoJCQkkZXhjbHVkZSA9IGRvX2xp
c3QoJGV4Y2x1ZGUpOwoKCQkJJGV4Y2x1ZGUgPSBqb2luKCInLCciLCBkb1NsYXNoKCRleGNs
dWRlKSk7CgoJCQkkZXhjbHVkZSA9ICJhbmQgbmFtZSBub3QgaW4oJyRleGNsdWRlJykiOwoJ
CX0KCgkJaWYgKCRwYXJlbnQpIHsKCQkJJHFzID0gc2FmZV9yb3coJ2xmdCwgcmd0JywgJ3R4
cF9jYXRlZ29yeScsICJuYW1lID0gJyIuZG9TbGFzaCgkcGFyZW50KS4iJyIpOwoKCQkJaWYg
KCRxcykgewoJCQkJZXh0cmFjdCgkcXMpOwoKCQkJCSRycyA9IHNhZmVfcm93c19zdGFydCgn
bmFtZSwgdGl0bGUnLCAndHhwX2NhdGVnb3J5JywKCQkJCQkiKGxmdCBiZXR3ZWVuICRsZnQg
YW5kICRyZ3QpIGFuZCB0eXBlID0gJyIuZG9TbGFzaCgkdHlwZSkuIicgYW5kIG5hbWUgIT0g
J2RlZmF1bHQnICRleGNsdWRlIG9yZGVyIGJ5IGxmdCBhc2MiKTsKCQkJfQoJCX0KCgkJZWxz
ZSB7CgkJCWlmKCRhY3RpdmVjYXRlZ29yaWVzID09ICduJyl7CgkJCQkkcnMgPSBzYWZlX3Jv
d3Nfc3RhcnQoJ25hbWUsIHRpdGxlJywgJ3R4cF9jYXRlZ29yeScsCgkJCQkidHlwZSA9ICck
dHlwZScgYW5kIG5hbWUgbm90IGluKCdkZWZhdWx0Jywncm9vdCcpICRleGNsdWRlIG9yZGVy
IGJ5IG5hbWUiKTsKCQkJfQoJCQllbHNlewoJCQkJJHRhYmxlID0gKCR0eXBlID09ICdhcnRp
Y2xlJykgPyAndGV4dHBhdHRlcm4nIDogJyc7CgkJCQkkdGFibGUgPSAoJHR5cGUgPT0gJ2lt
YWdlJykgPyAndHhwX2ltYWdlJyA6ICcnOwoJCQkJJHRhYmxlID0gKCR0eXBlID09ICdmaWxl
JykgPyAndHhwX2ZpbGUnIDogJycgOwoJCQkJJHRhYmxlID0gKCR0eXBlID09ICdsaW5rJykg
PyAndHhwX2xpbmsnIDogJycgOwoKCQkJCSRycyA9IHNhZmVfcm93c19zdGFydCgnbmFtZSwg
dGl0bGUnLCAkdGFibGUsCgkJCQkiZ3JvdXAgYnkgY2F0ZWdvcnkiKTsKCQkJCXByaW50X3Io
JHJzKTsKCQkJfQoJCX0KCX0KCglpZiAoJHJzKSB7CgkJJG91dCA9IGFycmF5KCk7CgoJCXdo
aWxlICgkYSA9IG5leHRSb3coJHJzKSkgewoJCQlleHRyYWN0KCRhKTsKCgkJCWlmICgkbmFt
ZSkgewoJCQkJJHNlY3Rpb24gPSAoJHRoaXNfc2VjdGlvbikgPyAoICRzID09ICdkZWZhdWx0
JyA/ICcnIDogJHMgKSA6ICRzZWN0aW9uOwoKCQkJCSRvdXRbXSA9IHRhZyhzdHJfcmVwbGFj
ZSgnJiAnLCAnJiMzODsgJywgJHRpdGxlKSwgJ2EnLAoJCQkJKCAoJGFjdGl2ZV9jbGFzcyBh
bmQgKCRjID09ICRuYW1lKSkgPyAnIGNsYXNzPSInLiRhY3RpdmVfY2xhc3MuJyInIDogJycg
KS4KCQkJCScgaHJlZj0iJy5wYWdlbGlua3VybChhcnJheSgncycgPT4gJHNlY3Rpb24sICdj
JyA9PiAkbmFtZSkpLiciJwoJCQkJKTsKCQkJfQoJCX0KCgkJaWYgKCRvdXQpCgkJewoJCQly
ZXR1cm4gZG9MYWJlbCgkbGFiZWwsICRsYWJlbHRhZykuZG9XcmFwKCRvdXQsICR3cmFwdGFn
LCAkYnJlYWssICRjbGFzcyk7CgkJfQoJfQoKCXJldHVybiAnJzsKfQoiO3M6MzoibWQ1Ijtz
OjMyOiI3NGJiMGEyMzM2NDU3YzA2MTM0N2MzZTU4ZmRmOTU4NiI7fQ==
