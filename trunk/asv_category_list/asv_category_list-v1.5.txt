# asv_category_list v1.5
# Extends the functionality of category_list
# Amit Varia
# http://www.amitvaria.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTc6ImFzdl9jYXRlZ29yeV9saXN0IjtzOjc6InZlcnNpb24i
O3M6MzoiMS41IjtzOjY6ImF1dGhvciI7czoxMDoiQW1pdCBWYXJpYSI7czoxMDoiYXV0aG9y
X3VyaSI7czoyNToiaHR0cDovL3d3dy5hbWl0dmFyaWEuY29tLyI7czoxMToiZGVzY3JpcHRp
b24iO3M6NDI6IkV4dGVuZHMgdGhlIGZ1bmN0aW9uYWxpdHkgb2YgY2F0ZWdvcnlfbGlzdCI7
czo0OiJ0eXBlIjtpOjA7czo0OiJoZWxwIjtzOjM1ODM6Igk8aDE+YXN2X2NhdGVnb3J5X2xp
c3Q8L2gxPgoKCTxoMiBpZD0iQ29udGVudHMiPkNvbnRlbnRzPC9oMj4KCgk8cCBzdHlsZT0i
cGFkZGluZy1sZWZ0OjFlbTsiPjxhIGhyZWY9IiNDbGFzc2lmaWNhdGlvbiI+Q2xhc3NpZmlj
YXRpb248L2E+PGJyIC8+CjxhIGhyZWY9IiNTeW50YXgiPlN5bnRheDwvYT48YnIgLz4KPGEg
aHJlZj0iI0F0dHJpYnV0ZXMiPkF0dHJpYnV0ZXM8L2E+PGJyIC8+CjxhIGhyZWY9IiNFeGFt
cGxlcyI+RXhhbXBsZXM8L2E+PGJyIC8+CjxhIGhyZWY9IiNIaXN0b3J5Ij5IaXN0b3J5PC9h
PjwvcD4KCgk8aDIgaWQ9IkNsYXNzaWZpY2F0aW9uIj5DbGFzc2lmaWNhdGlvbjwvaDI+CgoJ
PHA+PGEgaHJlZj0iI0NvbnRlbnRzIj5CYWNrIHRvIENvbnRlbnRzPC9hPjwvcD4KCgk8aDIg
aWQ9IlN5bnRheCI+U3ludGF4PC9oMj4KCgk8cD48YSBocmVmPSIjQ29udGVudHMiPkJhY2sg
dG8gQ29udGVudHM8L2E+PC9wPgoKCTxoMiBpZD0iQXR0cmlidXRlcyI+QXR0cmlidXRlczwv
aDI+CgoJPHA+PGNvZGU+YWN0aXZlX2NsYXNzPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFk
ZGluZy1sZWZ0OjFlbTsiPnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0Ym9vay50ZXh0
cGF0dGVybi5uZXQvd2lraS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5X2xpc3RfLyI+
VGV4dEJvb2s8L2E+PC9wPgoKCTxwPjxjb2RlPmFjdGl2ZWNhdGVnb3JpZXM8L2NvZGU+PC9w
PgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+PGVtPmRlZmF1bHQ6PC9lbT4gbjwv
cD4KCgk8cCBzdHlsZT0icGFkZGluZy1sZWZ0OjFlbTsiPkluY2x1ZGUgb25seSBjYXRlZ29y
aWVzIHRoYXQgaGF2ZSBhdCBsZWFzdCBvbmUgYXJ0aWNsZSBhc3NvY2lhdGVkIHRvIGl0Ljwv
cD4KCgk8cD48Y29kZT5icmVhazwvY29kZT48L3A+CgoJPHAgc3R5bGU9InBhZGRpbmctbGVm
dDoxZW07Ij5yZWZlciB0byA8YSBocmVmPSJodHRwOi8vdGV4dGJvb2sudGV4dHBhdHRlcm4u
bmV0L3dpa2kvaW5kZXgucGhwP3RpdGxlPVR4cDpjYXRlZ29yeV9saXN0Xy8iPlRleHRCb29r
PC9hPjwvcD4KCgk8cD48Y29kZT5jYXRlZ29yaWVzPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0i
cGFkZGluZy1sZWZ0OjFlbTsiPnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0Ym9vay50
ZXh0cGF0dGVybi5uZXQvd2lraS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5X2xpc3Rf
LyI+VGV4dEJvb2s8L2E+PC9wPgoKCTxwPjxjb2RlPmNsYXNzPC9jb2RlPjwvcD4KCgk8cCBz
dHlsZT0icGFkZGluZy1sZWZ0OjFlbTsiPnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0
Ym9vay50ZXh0cGF0dGVybi5uZXQvd2lraS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5
X2xpc3RfLyI+VGV4dEJvb2s8L2E+PC9wPgoKCTxwPjxjb2RlPmV4Y2x1ZGU8L2NvZGU+PC9w
PgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+cmVmZXIgdG8gPGEgaHJlZj0iaHR0
cDovL3RleHRib29rLnRleHRwYXR0ZXJuLm5ldC93aWtpL2luZGV4LnBocD90aXRsZT1UeHA6
Y2F0ZWdvcnlfbGlzdF8vIj5UZXh0Qm9vazwvYT48L3A+CgoJPHA+PGNvZGU+bGFiZWw8L2Nv
ZGU+PC9wPgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+cmVmZXIgdG8gPGEgaHJl
Zj0iaHR0cDovL3RleHRib29rLnRleHRwYXR0ZXJuLm5ldC93aWtpL2luZGV4LnBocD90aXRs
ZT1UeHA6Y2F0ZWdvcnlfbGlzdF8vIj5UZXh0Qm9vazwvYT48L3A+CgoJPHA+PGNvZGU+bGFi
ZWx0YWc8L2NvZGU+PC9wPgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+cmVmZXIg
dG8gPGEgaHJlZj0iaHR0cDovL3RleHRib29rLnRleHRwYXR0ZXJuLm5ldC93aWtpL2luZGV4
LnBocD90aXRsZT1UeHA6Y2F0ZWdvcnlfbGlzdF8vIj5UZXh0Qm9vazwvYT48L3A+CgoJPHA+
PGNvZGU+cGFyZW50PC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFkZGluZy1sZWZ0OjFlbTsi
PnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0Ym9vay50ZXh0cGF0dGVybi5uZXQvd2lr
aS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5X2xpc3RfLyI+VGV4dEJvb2s8L2E+PC9w
PgoKCTxwPjxjb2RlPnJzc19saW5rPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFkZGluZy1s
ZWZ0OjFlbTsiPkluY29tcGxldGU8L3A+CgoJPHA+PGNvZGU+cnNzX2NsYXNzPC9jb2RlPjwv
cD4KCgk8cCBzdHlsZT0icGFkZGluZy1sZWZ0OjFlbTsiPkluY29tcGxldGU8L3A+CgoJPHA+
PGNvZGU+cnNzX3RpdGxlPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFkZGluZy1sZWZ0OjFl
bTsiPkluY29tcGxldGU8L3A+CgoJPHA+PGNvZGU+cnNzX3NlcGVyYXRvcjwvY29kZT48L3A+
CgoJPHAgc3R5bGU9InBhZGRpbmctbGVmdDoxZW07Ij5JbmNvbXBsZXRlPC9wPgoKCTxwPjxj
b2RlPnNlY3Rpb248L2NvZGU+PC9wPgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+
cmVmZXIgdG8gPGEgaHJlZj0iaHR0cDovL3RleHRib29rLnRleHRwYXR0ZXJuLm5ldC93aWtp
L2luZGV4LnBocD90aXRsZT1UeHA6Y2F0ZWdvcnlfbGlzdF8vIj5UZXh0Qm9vazwvYT48L3A+
CgoJPHA+PGNvZGU+dGhpc19zZWN0aW9uPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFkZGlu
Zy1sZWZ0OjFlbTsiPnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0Ym9vay50ZXh0cGF0
dGVybi5uZXQvd2lraS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5X2xpc3RfLyI+VGV4
dEJvb2s8L2E+PC9wPgoKCTxwPjxjb2RlPnR5cGU8L2NvZGU+PC9wPgoKCTxwIHN0eWxlPSJw
YWRkaW5nLWxlZnQ6MWVtOyI+cmVmZXIgdG8gPGEgaHJlZj0iaHR0cDovL3RleHRib29rLnRl
eHRwYXR0ZXJuLm5ldC93aWtpL2luZGV4LnBocD90aXRsZT1UeHA6Y2F0ZWdvcnlfbGlzdF8v
Ij5UZXh0Qm9vazwvYT48L3A+CgoJPHA+PGNvZGU+d3JhcHRhZzwvY29kZT48L3A+CgoJPHAg
c3R5bGU9InBhZGRpbmctbGVmdDoxZW07Ij5yZWZlciB0byA8YSBocmVmPSJodHRwOi8vdGV4
dGJvb2sudGV4dHBhdHRlcm4ubmV0L3dpa2kvaW5kZXgucGhwP3RpdGxlPVR4cDpjYXRlZ29y
eV9saXN0Xy8iPlRleHRCb29rPC9hPjwvcD4KCgk8cD48YSBocmVmPSIjQ29udGVudHMiPkJh
Y2sgdG8gQ29udGVudHM8L2E+PC9wPgoKCTxoMiBpZD0iRXhhbXBsZXMiPkV4YW1wbGVzPC9o
Mj4KCgk8cD48YSBocmVmPSIjQ29udGVudHMiPkJhY2sgdG8gQ29udGVudHM8L2E+PC9wPgoK
CTxoMiBpZD0iSGlzdG9yeSI+SGlzdG9yeTwvaDI+CgoJPHRhYmxlPgoJCTx0cj4KCQkJPHRk
PiBWZXJzaW9uIDwvdGQ+CgkJCTx0ZD4gRGF0ZSA8L3RkPgoJCQk8dGQ+IENoYW5nZXMgPC90
ZD4KCQk8L3RyPgoJCTx0cj4KCQkJPHRkPiAxLjAgPC90ZD4KCQkJPHRkPiA/IDwvdGQ+CgkJ
CTx0ZD4gUGx1Z2luIGNyZWF0ZWQ8L3RkPgoJCTwvdHI+CgkJPHRyPgoJCQk8dGQ+IDEuNSA8
L3RkPgoJCQk8dGQ+IDEyLzA1LzIwMDYgPC90ZD4KCQkJPHRkPiBBZGRlZCA8c3BhbiBjbGFz
cz0iY2FwcyI+UlNTPC9zcGFuPiBmdW5jdGlvbmFsaXR5IDwvdGQ+CgkJPC90cj4KCTwvdGFi
bGU+CgoJPHA+PGEgaHJlZj0iI0NvbnRlbnRzIj5CYWNrIHRvIENvbnRlbnRzPC9hPjwvcD4i
O3M6NDoiY29kZSI7czoyNTU5OiJmdW5jdGlvbiBhc3ZfY2F0ZWdvcnlfbGlzdCgkYXR0cykg
ewoJZ2xvYmFsICRzLCAkYzsKCglleHRyYWN0KGxBdHRzKGFycmF5KAoJCSdhY3RpdmVfY2xh
c3MnID0+ICcnLAoJCSdicmVhaycgICAgICAgID0+IGJyLAoJCSdjYXRlZ29yaWVzJyAgID0+
ICcnLAoJCSdjbGFzcycgICAgICAgID0+IF9fRlVOQ1RJT05fXywKCQknZXhjbHVkZScgICAg
ICA9PiAnJywKCQknbGFiZWwnICAgICAgICA9PiAnJywKCQknbGFiZWx0YWcnICAgICA9PiAn
JywKCQkncGFyZW50JyAgICAgICA9PiAnJywKCQknc2VjdGlvbicgICAgICA9PiAnJywKCQkn
dGhpc19zZWN0aW9uJyA9PiAwLAoJCSd0eXBlJyAgICAgICAgID0+ICdhcnRpY2xlJywKCQkn
d3JhcHRhZycgICAgICA9PiAnJywKCQknYWN0aXZlY2F0ZWdvcmllcycgPT4gJ24nLAoJCSdy
c3NfbGluaycJCT0+ICduJywKCQkncnNzX3RpdGxlJwkJPT4gJ3JzcycsCgkJJ3Jzc19jbGFz
cycJCT0+ICcnLAoJCSdyc3Nfc2VwZXJhdG9yJwk9PiAnICcsCgoJKSwgJGF0dHMpKTsKCglp
ZiAoJGNhdGVnb3JpZXMpIHsKCQkkY2F0ZWdvcmllcyA9IGRvX2xpc3QoJGNhdGVnb3JpZXMp
OwoJCSRjYXRlZ29yaWVzID0gam9pbigiJywnIiwgZG9TbGFzaCgkY2F0ZWdvcmllcykpOwoK
CQkkcnMgPSBzYWZlX3Jvd3Nfc3RhcnQoJ25hbWUsIHRpdGxlJywgJ3R4cF9jYXRlZ29yeScs
CgkJInR5cGUgPSAnIi5kb1NsYXNoKCR0eXBlKS4iJyBhbmQgbmFtZSBpbiAoJyRjYXRlZ29y
aWVzJykgb3JkZXIgYnkgZmllbGQobmFtZSwgJyRjYXRlZ29yaWVzJykiKTsKCX0KCgllbHNl
IHsKCQlpZiAoJGV4Y2x1ZGUpIHsKCQkJJGV4Y2x1ZGUgPSBkb19saXN0KCRleGNsdWRlKTsK
CgkJCSRleGNsdWRlID0gam9pbigiJywnIiwgZG9TbGFzaCgkZXhjbHVkZSkpOwoKCQkJJGV4
Y2x1ZGUgPSAiYW5kIG5hbWUgbm90IGluKCckZXhjbHVkZScpIjsKCQl9CgoJCWlmICgkcGFy
ZW50KSB7CgkJCSRxcyA9IHNhZmVfcm93KCdsZnQsIHJndCcsICd0eHBfY2F0ZWdvcnknLCAi
bmFtZSA9ICciLmRvU2xhc2goJHBhcmVudCkuIiciKTsKCgkJCWlmICgkcXMpIHsKCQkJCWV4
dHJhY3QoJHFzKTsKCgkJCQkkcnMgPSBzYWZlX3Jvd3Nfc3RhcnQoJ25hbWUsIHRpdGxlJywg
J3R4cF9jYXRlZ29yeScsCgkJCQkJIihsZnQgYmV0d2VlbiAkbGZ0IGFuZCAkcmd0KSBhbmQg
dHlwZSA9ICciLmRvU2xhc2goJHR5cGUpLiInIGFuZCBuYW1lICE9ICdkZWZhdWx0JyAkZXhj
bHVkZSBvcmRlciBieSBsZnQgYXNjIik7CgkJCX0KCQl9CgoJCWVsc2UgewoJCQlpZigkYWN0
aXZlY2F0ZWdvcmllcyA9PSAnbicpewoJCQkJJHJzID0gc2FmZV9yb3dzX3N0YXJ0KCduYW1l
LCB0aXRsZScsICd0eHBfY2F0ZWdvcnknLAoJCQkJInR5cGUgPSAnJHR5cGUnIGFuZCBuYW1l
IG5vdCBpbignZGVmYXVsdCcsJ3Jvb3QnKSAkZXhjbHVkZSBvcmRlciBieSBuYW1lIik7CgkJ
CX0KCQkJZWxzZXsKCQkJCSR0YWJsZSA9ICgkdHlwZSA9PSAnYXJ0aWNsZScpID8gJ3RleHRw
YXR0ZXJuJyA6ICcnOwoJCQkJJHRhYmxlID0gKCR0eXBlID09ICdpbWFnZScpID8gJ3R4cF9p
bWFnZScgOiAnJzsKCQkJCSR0YWJsZSA9ICgkdHlwZSA9PSAnZmlsZScpID8gJ3R4cF9maWxl
JyA6ICcnIDsKCQkJCSR0YWJsZSA9ICgkdHlwZSA9PSAnbGluaycpID8gJ3R4cF9saW5rJyA6
ICcnIDsKCgkJCQkkcnMgPSBzYWZlX3Jvd3Nfc3RhcnQoJ25hbWUsIHRpdGxlJywgJHRhYmxl
LAoJCQkJImdyb3VwIGJ5IGNhdGVnb3J5Iik7CgkJCX0KCQl9Cgl9CgoJaWYgKCRycykgewoJ
CSRvdXQgPSBhcnJheSgpOwoKCQl3aGlsZSAoJGEgPSBuZXh0Um93KCRycykpIHsKCQkJZXh0
cmFjdCgkYSk7CgoJCQlpZiAoJG5hbWUpIHsKCQkJCSRzZWN0aW9uID0gKCR0aGlzX3NlY3Rp
b24pID8gKCAkcyA9PSAnZGVmYXVsdCcgPyAnJyA6ICRzICkgOiAkc2VjdGlvbjsKCgkJCQkk
cnNzID0gKCRyc3NfbGluayA9PSAneScgfHwgJHJzc19saW5rID09ICdZJykgPyB0cnVlIDog
ZmFsc2U7CgkJCQkkcnNzb3V0ID0gJyc7CgoJCQkJaWYoJHJzcyl7CgkJCQkJJHJzc2xpbmsg
PSBwYWdlbGlua3VybChhcnJheSgnYycgPT4gJG5hbWUsICdyc3MnID0+ICd5JykpOwoJCQkJ
CSRyc3NvdXQgPSAkcnNzX3NlcGVyYXRvci50YWcoJHJzc190aXRsZSwgJ2EnLCAoKCRyc3Nf
Y2xhc3MpID8gJyBjbGFzcz0iJy4kcnNzX2NsYXNzLiciJyA6ICcnKS4nIGhyZWY9IicuJHJz
c2xpbmsuJyInKTsKCQkJCX0KCgkJCQkkb3V0W10gPSB0YWcoc3RyX3JlcGxhY2UoJyYgJywg
JyYjMzg7ICcsICR0aXRsZSksICdhJywKCQkJCSggKCRhY3RpdmVfY2xhc3MgYW5kICgkYyA9
PSAkbmFtZSkpID8gJyBjbGFzcz0iJy4kYWN0aXZlX2NsYXNzLiciJyA6ICcnICkuCgkJCQkn
IGhyZWY9IicucGFnZWxpbmt1cmwoYXJyYXkoJ3MnID0+ICRzZWN0aW9uLCAnYycgPT4gJG5h
bWUpKS4nIicKCQkJCSkuJHJzc291dDsKCQkJfQoJCX0KCgkJaWYgKCRvdXQpCgkJewoJCQly
ZXR1cm4gZG9MYWJlbCgkbGFiZWwsICRsYWJlbHRhZykuZG9XcmFwKCRvdXQsICR3cmFwdGFn
LCAkYnJlYWssICRjbGFzcyk7CgkJfQoJfQoKCXJldHVybiAnJzsKfQoiO3M6MzoibWQ1Ijtz
OjMyOiI3NGM2ZmM0OTdmZmQ0ZTEzYzkyMGM1YzZmNzYzNTQ3MiI7fQ==
