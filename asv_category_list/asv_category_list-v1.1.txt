# asv_category_list v1.5
# Extends the functionality of category_list
# Amit Varia
# http://www.amitvaria.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTc6ImFzdl9jYXRlZ29yeV9saXN0IjtzOjc6InZlcnNpb24i
O3M6MzoiMS41IjtzOjY6ImF1dGhvciI7czoxMDoiQW1pdCBWYXJpYSI7czoxMDoiYXV0aG9y
X3VyaSI7czoyNToiaHR0cDovL3d3dy5hbWl0dmFyaWEuY29tLyI7czoxMToiZGVzY3JpcHRp
b24iO3M6NDI6IkV4dGVuZHMgdGhlIGZ1bmN0aW9uYWxpdHkgb2YgY2F0ZWdvcnlfbGlzdCI7
czo0OiJ0eXBlIjtpOjA7czo0OiJoZWxwIjtzOjM1MzM6Igk8aDE+YXN2X2NhdGVnb3J5X2xp
c3Q8L2gxPgoKCTxoMiBpZD0iQ29udGVudHMiPkNvbnRlbnRzPC9oMj4KCgk8cCBzdHlsZT0i
cGFkZGluZy1sZWZ0OjFlbTsiPjxhIGhyZWY9IiNDbGFzc2lmaWNhdGlvbiI+Q2xhc3NpZmlj
YXRpb248L2E+PGJyIC8+CjxhIGhyZWY9IiNTeW50YXgiPlN5bnRheDwvYT48YnIgLz4KPGEg
aHJlZj0iI0F0dHJpYnV0ZXMiPkF0dHJpYnV0ZXM8L2E+PGJyIC8+CjxhIGhyZWY9IiNFeGFt
cGxlcyI+RXhhbXBsZXM8L2E+PGJyIC8+CjxhIGhyZWY9IiNIaXN0b3J5Ij5IaXN0b3J5PC9h
PjwvcD4KCgk8aDIgaWQ9IkNsYXNzaWZpY2F0aW9uIj5DbGFzc2lmaWNhdGlvbjwvaDI+CgoJ
PHA+PGEgaHJlZj0iI0NvbnRlbnRzIj5CYWNrIHRvIENvbnRlbnRzPC9hPjwvcD4KCgk8aDIg
aWQ9IlN5bnRheCI+U3ludGF4PC9oMj4KCgk8cD48YSBocmVmPSIjQ29udGVudHMiPkJhY2sg
dG8gQ29udGVudHM8L2E+PC9wPgoKCTxoMiBpZD0iQXR0cmlidXRlcyI+QXR0cmlidXRlczwv
aDI+CgoJPHA+PGNvZGU+YWN0aXZlX2NsYXNzPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFk
ZGluZy1sZWZ0OjFlbTsiPnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0Ym9vay50ZXh0
cGF0dGVybi5uZXQvd2lraS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5X2xpc3RfLyI+
VGV4dEJvb2s8L2E+PC9wPgoKCTxwPjxjb2RlPmFjdGl2ZWNhdGVnb3JpZXM8L2NvZGU+PC9w
PgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+PGVtPmRlZmF1bHQ6PC9lbT4gbjwv
cD4KCgk8cCBzdHlsZT0icGFkZGluZy1sZWZ0OjFlbTsiPkluY2x1ZGUgb25seSBjYXRlZ29y
aWVzIHRoYXQgaGF2ZSBhdCBsZWFzdCBvbmUgYXJ0aWNsZSBhc3NvY2lhdGVkIHRvIGl0Ljwv
cD4KCgk8cD48Y29kZT5icmVhazwvY29kZT48L3A+CgoJPHAgc3R5bGU9InBhZGRpbmctbGVm
dDoxZW07Ij5yZWZlciB0byA8YSBocmVmPSJodHRwOi8vdGV4dGJvb2sudGV4dHBhdHRlcm4u
bmV0L3dpa2kvaW5kZXgucGhwP3RpdGxlPVR4cDpjYXRlZ29yeV9saXN0Xy8iPlRleHRCb29r
PC9hPjwvcD4KCgk8cD48Y29kZT5jYXRlZ29yaWVzPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0i
cGFkZGluZy1sZWZ0OjFlbTsiPnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0Ym9vay50
ZXh0cGF0dGVybi5uZXQvd2lraS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5X2xpc3Rf
LyI+VGV4dEJvb2s8L2E+PC9wPgoKCTxwPjxjb2RlPmNsYXNzPC9jb2RlPjwvcD4KCgk8cCBz
dHlsZT0icGFkZGluZy1sZWZ0OjFlbTsiPnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0
Ym9vay50ZXh0cGF0dGVybi5uZXQvd2lraS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5
X2xpc3RfLyI+VGV4dEJvb2s8L2E+PC9wPgoKCTxwPjxjb2RlPmV4Y2x1ZGU8L2NvZGU+PC9w
PgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+cmVmZXIgdG8gPGEgaHJlZj0iaHR0
cDovL3RleHRib29rLnRleHRwYXR0ZXJuLm5ldC93aWtpL2luZGV4LnBocD90aXRsZT1UeHA6
Y2F0ZWdvcnlfbGlzdF8vIj5UZXh0Qm9vazwvYT48L3A+CgoJPHA+PGNvZGU+bGFiZWw8L2Nv
ZGU+PC9wPgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+cmVmZXIgdG8gPGEgaHJl
Zj0iaHR0cDovL3RleHRib29rLnRleHRwYXR0ZXJuLm5ldC93aWtpL2luZGV4LnBocD90aXRs
ZT1UeHA6Y2F0ZWdvcnlfbGlzdF8vIj5UZXh0Qm9vazwvYT48L3A+CgoJPHA+PGNvZGU+bGFi
ZWx0YWc8L2NvZGU+PC9wPgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+cmVmZXIg
dG8gPGEgaHJlZj0iaHR0cDovL3RleHRib29rLnRleHRwYXR0ZXJuLm5ldC93aWtpL2luZGV4
LnBocD90aXRsZT1UeHA6Y2F0ZWdvcnlfbGlzdF8vIj5UZXh0Qm9vazwvYT48L3A+CgoJPHA+
PGNvZGU+cGFyZW50PC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFkZGluZy1sZWZ0OjFlbTsi
PnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0Ym9vay50ZXh0cGF0dGVybi5uZXQvd2lr
aS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5X2xpc3RfLyI+VGV4dEJvb2s8L2E+PC9w
PgoKCTxwPjxjb2RlPnJzc19saW5rPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFkZGluZy1s
ZWZ0OjFlbTsiPkluY29tcGxldGU8L3A+CgoJPHA+PGNvZGU+cnNzX2NsYXNzPC9jb2RlPjwv
cD4KCgk8cCBzdHlsZT0icGFkZGluZy1sZWZ0OjFlbTsiPkluY29tcGxldGU8L3A+CgoJPHA+
PGNvZGU+cnNzX3RpdGxlPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFkZGluZy1sZWZ0OjFl
bTsiPkluY29tcGxldGU8L3A+CgoJPHA+PGNvZGU+cnNzX3NlcGVyYXRvcjwvY29kZT48L3A+
CgoJPHAgc3R5bGU9InBhZGRpbmctbGVmdDoxZW07Ij5JbmNvbXBsZXRlPC9wPgoKCTxwPjxj
b2RlPnNlY3Rpb248L2NvZGU+PC9wPgoKCTxwIHN0eWxlPSJwYWRkaW5nLWxlZnQ6MWVtOyI+
cmVmZXIgdG8gPGEgaHJlZj0iaHR0cDovL3RleHRib29rLnRleHRwYXR0ZXJuLm5ldC93aWtp
L2luZGV4LnBocD90aXRsZT1UeHA6Y2F0ZWdvcnlfbGlzdF8vIj5UZXh0Qm9vazwvYT48L3A+
CgoJPHA+PGNvZGU+dGhpc19zZWN0aW9uPC9jb2RlPjwvcD4KCgk8cCBzdHlsZT0icGFkZGlu
Zy1sZWZ0OjFlbTsiPnJlZmVyIHRvIDxhIGhyZWY9Imh0dHA6Ly90ZXh0Ym9vay50ZXh0cGF0
dGVybi5uZXQvd2lraS9pbmRleC5waHA/dGl0bGU9VHhwOmNhdGVnb3J5X2xpc3RfLyI+VGV4
dEJvb2s8L2E+PC9wPgoKCTxwPjxjb2RlPnR5cGU8L2NvZGU+PC9wPgoKCTxwIHN0eWxlPSJw
YWRkaW5nLWxlZnQ6MWVtOyI+cmVmZXIgdG8gPGEgaHJlZj0iaHR0cDovL3RleHRib29rLnRl
eHRwYXR0ZXJuLm5ldC93aWtpL2luZGV4LnBocD90aXRsZT1UeHA6Y2F0ZWdvcnlfbGlzdF8v
Ij5UZXh0Qm9vazwvYT48L3A+CgoJPHA+PGNvZGU+d3JhcHRhZzwvY29kZT48L3A+CgoJPHAg
c3R5bGU9InBhZGRpbmctbGVmdDoxZW07Ij5yZWZlciB0byA8YSBocmVmPSJodHRwOi8vdGV4
dGJvb2sudGV4dHBhdHRlcm4ubmV0L3dpa2kvaW5kZXgucGhwP3RpdGxlPVR4cDpjYXRlZ29y
eV9saXN0Xy8iPlRleHRCb29rPC9hPjwvcD4KCgk8cD48YSBocmVmPSIjQ29udGVudHMiPkJh
Y2sgdG8gQ29udGVudHM8L2E+PC9wPgoKCTxoMiBpZD0iRXhhbXBsZXMiPkV4YW1wbGVzPC9o
Mj4KCgk8cD48YSBocmVmPSIjQ29udGVudHMiPkJhY2sgdG8gQ29udGVudHM8L2E+PC9wPgoK
CTxoMiBpZD0iSGlzdG9yeSI+SGlzdG9yeTwvaDI+CgoJPHRhYmxlPgoJCTx0cj4KCQkJPHRk
PiBWZXJzaW9uIDwvdGQ+CgkJCTx0ZD4gRGF0ZSA8L3RkPgoJCQk8dGQ+IENoYW5nZXMgPC90
ZD4KCQk8L3RyPgoJCTx0cj4KCQkJPHRkPiAxLjAgPC90ZD4KCQkJPHRkPiA/IDwvdGQ+CgkJ
CTx0ZD4gUGx1Z2luIGNyZWF0ZWQ8L3RkPgoJCTwvdHI+CgkJPHRyPgoJCQk8dGQ+IDEuNSA8
L3RkPgoJCQk8dGQ+IDEyLzA1LzIwMDYgPC90ZD4KCQkJPHRkPiBBZGRlZCA8c3BhbiBjbGFz
cz0iY2FwcyI+UlNTPC9zcGFuPiBmdW5jdGlvbmFsaXR5IDwvdGQ+CgkJPC90cj4KCTwvdGFi
bGU+IjtzOjQ6ImNvZGUiO3M6MjU1OToiZnVuY3Rpb24gYXN2X2NhdGVnb3J5X2xpc3QoJGF0
dHMpIHsKCWdsb2JhbCAkcywgJGM7CgoJZXh0cmFjdChsQXR0cyhhcnJheSgKCQknYWN0aXZl
X2NsYXNzJyA9PiAnJywKCQknYnJlYWsnICAgICAgICA9PiBiciwKCQknY2F0ZWdvcmllcycg
ICA9PiAnJywKCQknY2xhc3MnICAgICAgICA9PiBfX0ZVTkNUSU9OX18sCgkJJ2V4Y2x1ZGUn
ICAgICAgPT4gJycsCgkJJ2xhYmVsJyAgICAgICAgPT4gJycsCgkJJ2xhYmVsdGFnJyAgICAg
PT4gJycsCgkJJ3BhcmVudCcgICAgICAgPT4gJycsCgkJJ3NlY3Rpb24nICAgICAgPT4gJycs
CgkJJ3RoaXNfc2VjdGlvbicgPT4gMCwKCQkndHlwZScgICAgICAgICA9PiAnYXJ0aWNsZScs
CgkJJ3dyYXB0YWcnICAgICAgPT4gJycsCgkJJ2FjdGl2ZWNhdGVnb3JpZXMnID0+ICduJywK
CQkncnNzX2xpbmsnCQk9PiAnbicsCgkJJ3Jzc190aXRsZScJCT0+ICdyc3MnLAoJCSdyc3Nf
Y2xhc3MnCQk9PiAnJywKCQkncnNzX3NlcGVyYXRvcicJPT4gJyAnLAoKCSksICRhdHRzKSk7
CgoJaWYgKCRjYXRlZ29yaWVzKSB7CgkJJGNhdGVnb3JpZXMgPSBkb19saXN0KCRjYXRlZ29y
aWVzKTsKCQkkY2F0ZWdvcmllcyA9IGpvaW4oIicsJyIsIGRvU2xhc2goJGNhdGVnb3JpZXMp
KTsKCgkJJHJzID0gc2FmZV9yb3dzX3N0YXJ0KCduYW1lLCB0aXRsZScsICd0eHBfY2F0ZWdv
cnknLAoJCSJ0eXBlID0gJyIuZG9TbGFzaCgkdHlwZSkuIicgYW5kIG5hbWUgaW4gKCckY2F0
ZWdvcmllcycpIG9yZGVyIGJ5IGZpZWxkKG5hbWUsICckY2F0ZWdvcmllcycpIik7Cgl9CgoJ
ZWxzZSB7CgkJaWYgKCRleGNsdWRlKSB7CgkJCSRleGNsdWRlID0gZG9fbGlzdCgkZXhjbHVk
ZSk7CgoJCQkkZXhjbHVkZSA9IGpvaW4oIicsJyIsIGRvU2xhc2goJGV4Y2x1ZGUpKTsKCgkJ
CSRleGNsdWRlID0gImFuZCBuYW1lIG5vdCBpbignJGV4Y2x1ZGUnKSI7CgkJfQoKCQlpZiAo
JHBhcmVudCkgewoJCQkkcXMgPSBzYWZlX3JvdygnbGZ0LCByZ3QnLCAndHhwX2NhdGVnb3J5
JywgIm5hbWUgPSAnIi5kb1NsYXNoKCRwYXJlbnQpLiInIik7CgoJCQlpZiAoJHFzKSB7CgkJ
CQlleHRyYWN0KCRxcyk7CgoJCQkJJHJzID0gc2FmZV9yb3dzX3N0YXJ0KCduYW1lLCB0aXRs
ZScsICd0eHBfY2F0ZWdvcnknLAoJCQkJCSIobGZ0IGJldHdlZW4gJGxmdCBhbmQgJHJndCkg
YW5kIHR5cGUgPSAnIi5kb1NsYXNoKCR0eXBlKS4iJyBhbmQgbmFtZSAhPSAnZGVmYXVsdCcg
JGV4Y2x1ZGUgb3JkZXIgYnkgbGZ0IGFzYyIpOwoJCQl9CgkJfQoKCQllbHNlIHsKCQkJaWYo
JGFjdGl2ZWNhdGVnb3JpZXMgPT0gJ24nKXsKCQkJCSRycyA9IHNhZmVfcm93c19zdGFydCgn
bmFtZSwgdGl0bGUnLCAndHhwX2NhdGVnb3J5JywKCQkJCSJ0eXBlID0gJyR0eXBlJyBhbmQg
bmFtZSBub3QgaW4oJ2RlZmF1bHQnLCdyb290JykgJGV4Y2x1ZGUgb3JkZXIgYnkgbmFtZSIp
OwoJCQl9CgkJCWVsc2V7CgkJCQkkdGFibGUgPSAoJHR5cGUgPT0gJ2FydGljbGUnKSA/ICd0
ZXh0cGF0dGVybicgOiAnJzsKCQkJCSR0YWJsZSA9ICgkdHlwZSA9PSAnaW1hZ2UnKSA/ICd0
eHBfaW1hZ2UnIDogJyc7CgkJCQkkdGFibGUgPSAoJHR5cGUgPT0gJ2ZpbGUnKSA/ICd0eHBf
ZmlsZScgOiAnJyA7CgkJCQkkdGFibGUgPSAoJHR5cGUgPT0gJ2xpbmsnKSA/ICd0eHBfbGlu
aycgOiAnJyA7CgoJCQkJJHJzID0gc2FmZV9yb3dzX3N0YXJ0KCduYW1lLCB0aXRsZScsICR0
YWJsZSwKCQkJCSJncm91cCBieSBjYXRlZ29yeSIpOwoJCQl9CgkJfQoJfQoKCWlmICgkcnMp
IHsKCQkkb3V0ID0gYXJyYXkoKTsKCgkJd2hpbGUgKCRhID0gbmV4dFJvdygkcnMpKSB7CgkJ
CWV4dHJhY3QoJGEpOwoKCQkJaWYgKCRuYW1lKSB7CgkJCQkkc2VjdGlvbiA9ICgkdGhpc19z
ZWN0aW9uKSA/ICggJHMgPT0gJ2RlZmF1bHQnID8gJycgOiAkcyApIDogJHNlY3Rpb247CgoJ
CQkJJHJzcyA9ICgkcnNzX2xpbmsgPT0gJ3knIHx8ICRyc3NfbGluayA9PSAnWScpID8gdHJ1
ZSA6IGZhbHNlOwoJCQkJJHJzc291dCA9ICcnOwoKCQkJCWlmKCRyc3MpewoJCQkJCSRyc3Ns
aW5rID0gcGFnZWxpbmt1cmwoYXJyYXkoJ2MnID0+ICRuYW1lLCAncnNzJyA9PiAneScpKTsK
CQkJCQkkcnNzb3V0ID0gJHJzc19zZXBlcmF0b3IudGFnKCRyc3NfdGl0bGUsICdhJywgKCgk
cnNzX2NsYXNzKSA/ICcgY2xhc3M9IicuJHJzc19jbGFzcy4nIicgOiAnJykuJyBocmVmPSIn
LiRyc3NsaW5rLiciJyk7CgkJCQl9CgoJCQkJJG91dFtdID0gdGFnKHN0cl9yZXBsYWNlKCcm
ICcsICcmIzM4OyAnLCAkdGl0bGUpLCAnYScsCgkJCQkoICgkYWN0aXZlX2NsYXNzIGFuZCAo
JGMgPT0gJG5hbWUpKSA/ICcgY2xhc3M9IicuJGFjdGl2ZV9jbGFzcy4nIicgOiAnJyApLgoJ
CQkJJyBocmVmPSInLnBhZ2VsaW5rdXJsKGFycmF5KCdzJyA9PiAkc2VjdGlvbiwgJ2MnID0+
ICRuYW1lKSkuJyInCgkJCQkpLiRyc3NvdXQ7CgkJCX0KCQl9CgoJCWlmICgkb3V0KQoJCXsK
CQkJcmV0dXJuIGRvTGFiZWwoJGxhYmVsLCAkbGFiZWx0YWcpLmRvV3JhcCgkb3V0LCAkd3Jh
cHRhZywgJGJyZWFrLCAkY2xhc3MpOwoJCX0KCX0KCglyZXR1cm4gJyc7Cn0KIjtzOjM6Im1k
NSI7czozMjoiNzRjNmZjNDk3ZmZkNGUxM2M5MjBjNWM2Zjc2MzU0NzIiO30=
