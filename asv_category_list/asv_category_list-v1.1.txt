# asv_category_list v1.1
# Extends the functionality of category_list
# Amit Varia
# http://www.amitvaria.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTc6ImFzdl9jYXRlZ29yeV9saXN0IjtzOjc6InZlcnNpb24i
O3M6MzoiMS4xIjtzOjY6ImF1dGhvciI7czoxMDoiQW1pdCBWYXJpYSI7czoxMDoiYXV0aG9y
X3VyaSI7czoyNToiaHR0cDovL3d3dy5hbWl0dmFyaWEuY29tLyI7czoxMToiZGVzY3JpcHRp
b24iO3M6NDI6IkV4dGVuZHMgdGhlIGZ1bmN0aW9uYWxpdHkgb2YgY2F0ZWdvcnlfbGlzdCI7
czo0OiJ0eXBlIjtpOjA7czo0OiJoZWxwIjtzOjI5OiIJPGgxPmFzdl9jYXRlZ29yeV9saXN0
PC9oMT4KCiI7czo0OiJjb2RlIjtzOjIxNzk6ImZ1bmN0aW9uIGFzdl9jYXRlZ29yeV9saXN0
KCRhdHRzKSB7CglnbG9iYWwgJHMsICRjOwoKCWV4dHJhY3QobEF0dHMoYXJyYXkoCgkJJ2Fj
dGl2ZV9jbGFzcycgPT4gJycsCgkJJ2JyZWFrJyAgICAgICAgPT4gYnIsCgkJJ2NhdGVnb3Jp
ZXMnICAgPT4gJycsCgkJJ2NsYXNzJyAgICAgICAgPT4gX19GVU5DVElPTl9fLAoJCSdleGNs
dWRlJyAgICAgID0+ICcnLAoJCSdsYWJlbCcgICAgICAgID0+ICcnLAoJCSdsYWJlbHRhZycg
ICAgID0+ICcnLAoJCSdwYXJlbnQnICAgICAgID0+ICcnLAoJCSdzZWN0aW9uJyAgICAgID0+
ICcnLAoJCSd0aGlzX3NlY3Rpb24nID0+IDAsCgkJJ3R5cGUnICAgICAgICAgPT4gJ2FydGlj
bGUnLAoJCSd3cmFwdGFnJyAgICAgID0+ICcnLAoJCSdhY3RpdmVjYXRlZ29yaWVzJyA9PiAn
bicsCgkpLCAkYXR0cykpOwoKCWlmICgkY2F0ZWdvcmllcykgewoJCSRjYXRlZ29yaWVzID0g
ZG9fbGlzdCgkY2F0ZWdvcmllcyk7CgkJJGNhdGVnb3JpZXMgPSBqb2luKCInLCciLCBkb1Ns
YXNoKCRjYXRlZ29yaWVzKSk7CgoJCSRycyA9IHNhZmVfcm93c19zdGFydCgnbmFtZSwgdGl0
bGUnLCAndHhwX2NhdGVnb3J5JywKCQkidHlwZSA9ICciLmRvU2xhc2goJHR5cGUpLiInIGFu
ZCBuYW1lIGluICgnJGNhdGVnb3JpZXMnKSBvcmRlciBieSBmaWVsZChuYW1lLCAnJGNhdGVn
b3JpZXMnKSIpOwoJfQoKCWVsc2UgewoJCWlmICgkZXhjbHVkZSkgewoJCQkkZXhjbHVkZSA9
IGRvX2xpc3QoJGV4Y2x1ZGUpOwoKCQkJJGV4Y2x1ZGUgPSBqb2luKCInLCciLCBkb1NsYXNo
KCRleGNsdWRlKSk7CgoJCQkkZXhjbHVkZSA9ICJhbmQgbmFtZSBub3QgaW4oJyRleGNsdWRl
JykiOwoJCX0KCgkJaWYgKCRwYXJlbnQpIHsKCQkJJHFzID0gc2FmZV9yb3coJ2xmdCwgcmd0
JywgJ3R4cF9jYXRlZ29yeScsICJuYW1lID0gJyIuZG9TbGFzaCgkcGFyZW50KS4iJyIpOwoK
CQkJaWYgKCRxcykgewoJCQkJZXh0cmFjdCgkcXMpOwoKCQkJCSRycyA9IHNhZmVfcm93c19z
dGFydCgnbmFtZSwgdGl0bGUnLCAndHhwX2NhdGVnb3J5JywKCQkJCQkiKGxmdCBiZXR3ZWVu
ICRsZnQgYW5kICRyZ3QpIGFuZCB0eXBlID0gJyIuZG9TbGFzaCgkdHlwZSkuIicgYW5kIG5h
bWUgIT0gJ2RlZmF1bHQnICRleGNsdWRlIG9yZGVyIGJ5IGxmdCBhc2MiKTsKCQkJfQoJCX0K
CgkJZWxzZSB7CgkJCWlmKCRhY3RpdmVjYXRlZ29yaWVzID09ICduJyl7CgkJCQkkcnMgPSBz
YWZlX3Jvd3Nfc3RhcnQoJ25hbWUsIHRpdGxlJywgJ3R4cF9jYXRlZ29yeScsCgkJCQkidHlw
ZSA9ICckdHlwZScgYW5kIG5hbWUgbm90IGluKCdkZWZhdWx0Jywncm9vdCcpICRleGNsdWRl
IG9yZGVyIGJ5IG5hbWUiKTsKCQkJfQoJCQllbHNlewoJCQkJJHRhYmxlID0gKCR0eXBlID09
ICdhcnRpY2xlJykgPyAndGV4dHBhdHRlcm4nIDogJyc7CgkJCQkkdGFibGUgPSAoJHR5cGUg
PT0gJ2ltYWdlJykgPyAndHhwX2ltYWdlJyA6ICcnOwoJCQkJJHRhYmxlID0gKCR0eXBlID09
ICdmaWxlJykgPyAndHhwX2ZpbGUnIDogJycgOwoJCQkJJHRhYmxlID0gKCR0eXBlID09ICds
aW5rJykgPyAndHhwX2xpbmsnIDogJycgOwoKCQkJCSRycyA9IHNhZmVfcm93c19zdGFydCgn
bmFtZSwgdGl0bGUnLCAkdGFibGUsCgkJCQkiZ3JvdXAgYnkgY2F0ZWdvcnkiKTsKCQkJCXBy
aW50X3IoJHJzKTsKCQkJfQoJCX0KCX0KCglpZiAoJHJzKSB7CgkJJG91dCA9IGFycmF5KCk7
CgoJCXdoaWxlICgkYSA9IG5leHRSb3coJHJzKSkgewoJCQlleHRyYWN0KCRhKTsKCgkJCWlm
ICgkbmFtZSkgewoJCQkJJHNlY3Rpb24gPSAoJHRoaXNfc2VjdGlvbikgPyAoICRzID09ICdk
ZWZhdWx0JyA/ICcnIDogJHMgKSA6ICRzZWN0aW9uOwoKCQkJCSRvdXRbXSA9IHRhZyhzdHJf
cmVwbGFjZSgnJiAnLCAnJiMzODsgJywgJHRpdGxlKSwgJ2EnLAoJCQkJKCAoJGFjdGl2ZV9j
bGFzcyBhbmQgKCRjID09ICRuYW1lKSkgPyAnIGNsYXNzPSInLiRhY3RpdmVfY2xhc3MuJyIn
IDogJycgKS4KCQkJCScgaHJlZj0iJy5wYWdlbGlua3VybChhcnJheSgncycgPT4gJHNlY3Rp
b24sICdjJyA9PiAkbmFtZSkpLiciJwoJCQkJKTsKCQkJfQoJCX0KCgkJaWYgKCRvdXQpCgkJ
ewoJCQlyZXR1cm4gZG9MYWJlbCgkbGFiZWwsICRsYWJlbHRhZykuZG9XcmFwKCRvdXQsICR3
cmFwdGFnLCAkYnJlYWssICRjbGFzcyk7CgkJfQoJfQoKCXJldHVybiAnJzsKfQoiO3M6Mzoi
bWQ1IjtzOjMyOiI3NGJiMGEyMzM2NDU3YzA2MTM0N2MzZTU4ZmRmOTU4NiI7fQ==
