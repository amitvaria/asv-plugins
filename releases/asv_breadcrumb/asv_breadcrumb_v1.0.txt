# asv_breadcrumb 1.0
# Provides greater flexibility for <txp:breadcrumb />
# Amit Varia
# http://www.amitvaria.com

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTQ6ImFzdl9icmVhZGNydW1iIjtzOjY6ImF1dGhvciI7czoxMDoiQW1pdCBWYXJpYSI7czoxMDoiYXV0aG9yX3VyaSI7czoyNDoiaHR0cDovL3d3dy5hbWl0dmFyaWEuY29tIjtzOjc6InZlcnNpb24iO3M6MzoiMS4wIjtzOjExOiJkZXNjcmlwdGlvbiI7czo1MToiUHJvdmlkZXMgZ3JlYXRlciBmbGV4aWJpbGl0eSBmb3IgPHR4cDpicmVhZGNydW1iIC8+IjtzOjQ6ImhlbHAiO3M6MjA3MzoiPGgxPmFzdl9icmVhZGNydW1iPC9oMT4NCjxwPg0KPGVtPmxhc3QgdXBkYXRlZCAxMC8xNS8yMDA2PC9lbT4NCjwvcD4NCjxoMj5EZXNjcmlwdGlvbiZuYnNwOzwvaDI+DQo8cD4NCkkgY3JlYXRlZCB0aGlzIHBsdWdpbiBkdWUgdG8gaXNzdWVzIEkgd2FzIGhhdmluZyB3aXRoICZsdDt0eHA6YnJlYWRjcnVtYiAvJmd0Oy4gSXQgYWRkcmVzc2VzIGlzc3VlcyB3aXRoICZsdDt0eHA6YnJlYWRjcnVtYiAvJmd0OyBhbmQgZXhwYW5kcyBvbiB0aGUgdXNhYmlsaXR5LiBJIHN0YXJ0ZWQgd2l0aCB0aGUgZnVuY3Rpb24gZm9yICZsdDt0eHA6YnJlYWRjcnVtYiAvJmd0OyB3cml0dGVuIGZvciBUWFAgNC4wLjQgUkMxLiBUaGlzIGZ1bmN0aW9uIGhhZCBhZGRyZXNzZWQgaXNzdWUgd2l0aCBjaGFuZ2luZyB0aGUgbGFiZWwgZm9yIHRoZSBob21lIGxpbmsuIEJ1dCBpdCB3b3VsZG4ndCBzaG93IHRoZSBjYXRlZ29yeSB3aGVuIHZpZXdpbmcgYW4gaW5kaXZpZHVhbCBhcnRpY2xlLiBCb3RoIG9mIHRoZXNlIGhhdmUgYmVlbiBhZGRyZXNzZWQgaW4gdGhpcyBwbHVnaW4uIFBsZWFzZSByZXZpZXcgdGhlIGF0dHJpYnV0ZXMgYmVsb3cgdG8gYWxzbyBzZWUgbmV3IGZlYXR1cmVzLg0KPC9wPg0KPGgyPkF0dHJpYnV0ZXM8L2gyPg0KPHA+DQp3cmFwdGFnIC0gVGhpcyBzZXRzIHRoZSB0YWcgdGhhdCBpcyB3cmFwcGVkIGFyb3VuZCB0aGUgZW50aXJlIGJyZWFkY3J1bWIuIEJ5IGRlZmF1bHQgaXQgaXMgJ3AnLjxiciAvPg0Kc2VwIC0gVGhpcyBzZXRzIHRoZSBzZXBlcmF0b3IgYmV0d2VlbiBlYWNoIGJyZWFkY3J1bWIuIEJ5IGRlZmF1bHQgaXQgaXMgJyZhbXA7IzE2MDsmYW1wOyMxODc7JmFtcDsjMTYwJy48YnIgLz4NCmxpbmsgLSBUaGlzIHNldHMgd2hldGhlciB0byBjcmVhdGUgYSBsaW5rIHRvIHRoZSBwaWVjZXMgaW4gdGhlIGJyZWFkY3J1bWIuIEJ5IGRlZmF1bHQgaXQgaXMgJ3knLjxiciAvPg0KbGFiZWwgLSBUaGlzIHNldHMgdGhlIHRleHQgZm9yIHlvdXIgaG9tZXBhZ2UuIEJ5IGRlZmF1bHQgaXQgaXMgdGhlIHNpdGVuYW1lIGRlZmluZWQgaW4geW91ciBwcmVmZXJlbmNlcy4gPGJyIC8+DQp0aXRsZSAtIFRoaXMgc2V0cyB0byBzaG93IHRoZSB0aXRsZSBvciB0aGUgbmFtZS4gJ3knIHdpbGwgc2hvdyBzaG93IHRoZSB0aXRsZSwgYW5kIGJsYW5rIHdpbGwgc2hvdyB0aGUgbmFtZS4gQnkgZGVmYXVsdCBpdCBpcyBibGFuay48YnIgLz4NCmNsYXNzIC0gVGhpcyBzZXRzIHRoZSBjbGFzcyB0byBiZSB1c2VkIGZvciB0aGUgZW50aXJlIGJyZWFkY3J1bWIuIEJ5IGRlZmF1bHQgaXQgaXMgYmxhbmsuPGJyIC8+DQpsaW5rY2xhc3MgLSBUaGlzIHNldHMgdGhlIGNsYXNzIGZvciBlYWNoIGluZGl2aWR1YWwgbGluay4gQnkgZGVmYXVsdCBpdCBpcyAnbm9saW5lJzxiciAvPg0Kc2hvd3NlY3Rpb24gLSBUaGlzIHNldHMgd2hldGhlciB0byBpbmNsdWRlIHRoZSBzZWN0aW9uIG5hbWUgaW4gdGhlIGJyZWFkY3J1bWIuIEJ5IGRlZmF1bHQgaXQgaXMgdHJ1ZTxiciAvPg0KaG9tZXBhZ2UgLSBUaGlzIHNldHMgd2hldGhlciB0byBzaG93IGEgaG9tZSBsaW5rIG9uIHRoZSBob21lIHBhZ2Ugb3Igbm90aGluZyBhdCBhbGwuIEJ5IGRlZmF1bHQgaXQgaXMgJ24nIGFuZCB3aWxsIG5vdCBzaG93IHRoZSBob21lIHBhZ2UgbGluay48YnIgLz4NCmNhdHNlcCAtIElmIHlvdSBoYXZlIGFuIGFydGljbGUgd2l0aCB0d28gY2F0ZWdvcmllcyB0aGlzIHdpbGwgc2VwZXJhdGUgdGhlIHR3byBjYXRlZ29yeSB0cmVlcy4gQnkgZGVmYXVsdCBpdCBpcyAnLycuDQo8L3A+DQo8aDI+Q2hhbmdlIExvZzwvaDI+PHRhYmxlIHdpZHRoPSIxMTEiIGJvcmRlcj0iMCIgc3R5bGU9ImhlaWdodDogMjNweCI+PHRib2R5Pjx0cj48dGQ+RGF0ZTxiciAvPg0KPC90ZD48dGQ+VmVyc2lvbiA8YnIgLz4NCjwvdGQ+PHRkPkNoYW5nZXM8YnIgLz4NCjwvdGQ+PC90cj48dHI+PHRkPiZuYnNwOzEwLzEwLzIwMDY8L3RkPjx0ZD4xLjAgPGJyIC8+DQo8L3RkPjx0ZD5hc3ZfYnJlYWRjcnVtYiBpcyBjcmVhdGVkLiA8YnIgLz4NCjwvdGQ+PC90cj48L3Rib2R5PjwvdGFibGU+DQo8cD4NCiZuYnNwOw0KPC9wPg0KIjtzOjQ6ImNvZGUiO3M6MjQ1NzoiZnVuY3Rpb24gYXN2X2JyZWFkY3J1bWIoJGF0dHMpDQp7DQoJZ2xvYmFsICRwcmV0ZXh0LCR0aGlzYXJ0aWNsZSwkc2l0ZW5hbWU7DQoJDQoJZXh0cmFjdChsQXR0cyhhcnJheSgNCgknd3JhcHRhZycgPT4gJ3AnLA0KCSdzZXAnID0+ICcmIzE2MDsmIzE4NzsmIzE2MDsnLA0KCSdsaW5rJyA9PiAneScsDQoJJ2xhYmVsJyA9PiAkc2l0ZW5hbWUsDQoJJ3RpdGxlJyA9PiAnJywNCgknY2xhc3MnID0+ICcnLA0KCSdsaW5rY2xhc3MnID0+ICdub2xpbmUnLA0KCSdzaG93c2VjdGlvbicgPT4gJ3RydWUnLA0KCSdob21lcGFnZScgPT4gJ2ZhbHNlJywNCgknY2F0c2VwJyA9PiAnLycNCgkpLCRhdHRzKSk7DQoJJGxpbmtlZCA9ICgkbGluayA9PSAneScpPyB0cnVlOiBmYWxzZTsNCgkkaG9tZXBhZ2VkID0gKCRob21lcGFnZSA9PSAneScpPyB0cnVlOiBmYWxzZTsNCgkkc2hvd3NlY3Rpb25lZCA9ICgkc2hvd3NlY3Rpb24gPT0gJ3knKT8gdHJ1ZTogZmFsc2U7DQoJaWYgKCRsaW5rZWQpICRsYWJlbCA9IGRvVGFnKCRsYWJlbCwnYScsJGxpbmtjbGFzcywnIGhyZWY9IicuaHUuJyInKTsNCgkNCgkkY29udGVudCA9IGFycmF5KCk7DQoJZXh0cmFjdCgkcHJldGV4dCk7DQoJaWYoJHNob3dzZWN0aW9uZWQgJiYgIWVtcHR5KCRzKSAmJiAkcyE9ICdkZWZhdWx0Jyl7IA0KCQkkc2VjdGlvbl90aXRsZSA9ICgkdGl0bGUpID8gZmV0Y2hfc2VjdGlvbl90aXRsZSgkcykgOiAkczsNCgkJJHNlY3Rpb25fdGl0bGVfaHRtbCA9IGVzY2FwZV90aXRsZSgkc2VjdGlvbl90aXRsZSk7DQoJCSRjb250ZW50W10gPSAoJGxpbmtlZCk/ICgNCgkJZG9UYWcoJHNlY3Rpb25fdGl0bGVfaHRtbCwnYScsJGxpbmtjbGFzcywnIGhyZWY9IicucGFnZWxpbmt1cmwoYXJyYXkoJ3MnPT4kcykpLiciJykNCgkJKTokc2VjdGlvbl90aXRsZV9odG1sOw0KCX0NCgkNCglpZihlbXB0eSgkdGhpc2FydGljbGUpKXsNCgkJJGNhdGVnb3J5MSA9IGVtcHR5KCRjKT8gJyc6ICRjOw0KCX0NCgllbHNlew0KCQkkY2F0ZWdvcnkxID0gZW1wdHkoJHRoaXNhcnRpY2xlWydjYXRlZ29yeTEnXSk/ICIiIDogJHRoaXNhcnRpY2xlWydjYXRlZ29yeTEnXTsNCgkJJGNhdGVnb3J5MiA9IGVtcHR5KCR0aGlzYXJ0aWNsZVsnY2F0ZWdvcnkyJ10pPyAiIiA6ICR0aGlzYXJ0aWNsZVsnY2F0ZWdvcnkyJ107DQoJfQ0KDQoJZm9yZWFjaCAoZ2V0VHJlZVBhdGgoJGNhdGVnb3J5MSwgJ2FydGljbGUnKSBhcyAkY2F0KSB7DQoJCWlmICgkY2F0WyduYW1lJ10gIT0gJ3Jvb3QnKSB7DQoJCQkkY2F0ZWdvcnlfdGl0bGVfaHRtbCA9ICR0aXRsZT8gZXNjYXBlX3RpdGxlKCRjYXRbJ3RpdGxlJ10pIDogJGNhdFsnbmFtZSddOw0KCQkJJGNhdDFob2xkZXJbXSA9ICgkbGlua2VkKT8gDQoJCQlkb1RhZygkY2F0ZWdvcnlfdGl0bGVfaHRtbCwnYScsJGxpbmtjbGFzcywnIGhyZWY9IicucGFnZWxpbmt1cmwoYXJyYXkoJ2MnPT4kY2F0WyduYW1lJ10pKS4nIicpDQoJCQk6JGNhdGVnb3J5X3RpdGxlX2h0bWw7DQoJCX0NCgl9DQoNCglmb3JlYWNoIChnZXRUcmVlUGF0aCgkY2F0ZWdvcnkyLCAnYXJ0aWNsZScpIGFzICRjYXQpIHsNCgkJaWYgKCRjYXRbJ25hbWUnXSAhPSAncm9vdCcpIHsNCgkJCSRjYXRlZ29yeV90aXRsZV9odG1sID0gJHRpdGxlPyBlc2NhcGVfdGl0bGUoJGNhdFsndGl0bGUnXSkgOiAkY2F0WyduYW1lJ107DQoJCQkkY2F0MmhvbGRlcltdID0gKCRsaW5rZWQpPyANCgkJCWRvVGFnKCRjYXRlZ29yeV90aXRsZV9odG1sLCdhJywkbGlua2NsYXNzLCcgaHJlZj0iJy5wYWdlbGlua3VybChhcnJheSgnYyc9PiRjYXRbJ25hbWUnXSkpLiciJykNCgkJCTokY2F0ZWdvcnlfdGl0bGVfaHRtbDsNCgkJfQ0KCX0NCgkNCglpZighZW1wdHkoJGNhdDJob2xkZXIpKXsNCgkgJGNvbnRlbnRbXSA9IGpvaW4oJHNlcCwgJGNhdDFob2xkZXIpLiRjYXRzZXAuam9pbigkc2VwLCAkY2F0MmhvbGRlcik7DQoJfQ0KCWVsc2V7DQoJCWlmKCFlbXB0eSgkY2F0MWhvbGRlcikpew0KCQkJJGNvbnRlbnRbXSA9IGpvaW4oJHNlcCwgJGNhdDFob2xkZXIpOw0KCQl9DQoJfQ0KDQoJLy9BZGQgdGhlIGxhYmVsIGF0IHRoZSBlbmQsIHRvIHByZXZlbnQgYnJlYWRjcnVtYiBmb3IgaG9tZSBwYWdlDQoJLy8JCWlmICghZW1wdHkoJGNvbnRlbnQpKSAkY29udGVudCA9IGFycmF5X21lcmdlKGFycmF5KCRsYWJlbCksJGNvbnRlbnQpOw0KCWlmICgkaG9tZXBhZ2VkKXsgJGNvbnRlbnQgPSBhcnJheV9tZXJnZShhcnJheSgkbGFiZWwpLCRjb250ZW50KTt9DQoJZWxzZSB7aWYgKCFlbXB0eSgkY29udGVudCkpICRjb250ZW50ID0gYXJyYXlfbWVyZ2UoYXJyYXkoJGxhYmVsKSwkY29udGVudCk7fQ0KCS8vQWRkIGFydGljbGUgdGl0bGUgd2l0aG91dCBsaW5rIGlmIHdlJ3JlIG9uIGFuIGluZGl2aWR1YWwgYXJjaGl2ZSBwYWdlPw0KCXJldHVybiBkb1RhZyhqb2luKCRzZXAsICRjb250ZW50KSwgJHdyYXB0YWcsICRjbGFzcyk7DQp9IjtzOjQ6InR5cGUiO3M6MToiMCI7czozOiJtZDUiO3M6MzI6IjExNzVkYjg1YmI4M2FiNmQ3ODkyZjZlOTY4OWY5NTI1Ijt9