# asv_recent_comments v1.8
# Extends on the functionality of txp:recent_comments
# Amit Varia
# http://www.amitvaria.com/

# ......................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# ......................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTk6ImFzdl9yZWNlbnRfY29tbWVudHMiO3M6NzoidmVyc2lv
biI7czozOiIxLjgiO3M6NjoiYXV0aG9yIjtzOjEwOiJBbWl0IFZhcmlhIjtzOjEwOiJhdXRo
b3JfdXJpIjtzOjI1OiJodHRwOi8vd3d3LmFtaXR2YXJpYS5jb20vIjtzOjExOiJkZXNjcmlw
dGlvbiI7czo1MToiRXh0ZW5kcyBvbiB0aGUgZnVuY3Rpb25hbGl0eSBvZiB0eHA6cmVjZW50
X2NvbW1lbnRzIjtzOjQ6InR5cGUiO2k6MDtzOjQ6ImhlbHAiO3M6MDoiIjtzOjQ6ImNvZGUi
O3M6MzMyOToiZnVuY3Rpb24gYXN2X3JlY2VudF9jb21tZW50cygkYXR0cykKewoJZ2xvYmFs
ICRwcmV0ZXh0OwoJZXh0cmFjdChsQXR0cyhhcnJheSgKCQknYnJlYWsnCQkgPT4gYnIsCgkJ
J2NsYXNzJwkJID0+IF9fRlVOQ1RJT05fXywKCQknbGFiZWwnCQkgPT4gJycsCgkJJ2xhYmVs
dGFnJyA9PiAnJywKCQknbGltaXQnCQkgPT4gMTAsCgkJJ3NvcnQnICAgICA9PiAncG9zdGVk
IGRlc2MnLAoJCSd3cmFwdGFnJwkgPT4gJycsCgkJJ2Zvcm0nCQk9PiAnJywKCQknc2F3YXJl
Jwk9PiAnbicsCgkJJ2Nhd2FyZScJCT0+ICduJywKCQknc2VjdGlvbnMnCQk9PiAnJywKCQkn
Y2F0ZWdvcmllcycJPT4gJycsCgkJJ3NleGNsdWRlJwk9PiAnJywKCQknY2V4Y2x1ZGUnCT0+
ICcnLAoJCSdzaG93aG9tZScgPT4gJ3knLAoJCSdpZGF3YXJlJyA9PiAnbicsCgkJJ2lkJyA9
PiAnJywKCQknY2xhYmVsJyA9PiAnJywKCQknc2xhYmVsJyA9PiAnJywKCQknaWRleGNsdWRl
JyA9PiAnJwoJKSwgJGF0dHMpKTsKCgkoJGlkYXdhcmUgPT0gJ3knKSA/ICRpZCA9ICRwcmV0
ZXh0WydpZCddIDogJGlkOwoJaWYoJGlkKXsKCQkkcnMgPSBzYWZlX3Jvd3Nfc3RhcnQoJyon
LCAndHhwX2Rpc2N1c3MnLAoJCSJ2aXNpYmxlID0gIi5WSVNJQkxFLiIgIGFuZCBwYXJlbnRp
ZCA9ICRpZCBvcmRlciBieSAkc29ydCBsaW1pdCAwLCRsaW1pdCIpOwoJfQoJZWxzZXsKCQko
JHNhd2FyZSA9PSAneScpID8gJHNlY3Rpb25zID0gJHByZXRleHRbJ3MnXSA6ICRzZWN0aW9u
czsKCQkoJHNlY3Rpb25zID09ICdkZWZhdWx0JyAmJiAkc2hvd2hvbWU9J3knKSA/ICRzZWN0
aW9ucyA9ICcnIDogJHNlY3Rpb25zOwoJCWlmICgkc2VjdGlvbnMpCgkJewoJCQkkc2VjdGlv
bnMgPSBkb19saXN0KCRzZWN0aW9ucyk7CgkJCSRzZWN0aW9ucyA9IGpvaW4oIicsJyIsIGRv
U2xhc2goJHNlY3Rpb25zKSk7CgkJCSRzaW5jbHVkZSA9ICJhbmQgdGV4dHBhdHRlcm4uU2Vj
dGlvbiBpbignJHNlY3Rpb25zJykiOwoJCX0KCgkJKCRjYXdhcmUgPT0gJ3knKSA/ICRjYXRl
Z29yaWVzID0gJHByZXRleHRbJ2MnXSA6ICRjYXRlZ29yaWVzOwoJCWlmKCRjYXRlZ29yaWVz
KXsKCQkJJGNhdGVnb3JpZXMgPSBkb19saXN0KCRjYXRlZ29yaWVzKTsKCQkJJGNhdGVnb3Jp
ZXMgPSBqb2luKCInLCciLCBkb1NsYXNoKCRjYXRlZ29yaWVzKSk7CgkJCSRjaW5jbHVkZSA9
ICJhbmQgKHRleHRwYXR0ZXJuLkNhdGVnb3J5MSBpbignJGNhdGVnb3JpZXMnKSBPUiB0ZXh0
cGF0dGVybi5DYXRlZ29yeTIgaW4oJyRjYXRlZ29yaWVzJykpIjsKCQl9CgoJCWlmICgkc2V4
Y2x1ZGUgfHwgJGNleGNsdWRlKXsKCQkJCSRzZXhjbHVkZSA9IGRvX2xpc3QoJHNleGNsdWRl
KTsKCQkJCSRzZXhjbHVkZSA9IGpvaW4oIicsJyIsIGRvU2xhc2goJHNleGNsdWRlKSk7CgkJ
CQkkc2V4Y2x1ZGUgPSAiYW5kIHRleHRwYXR0ZXJuLlNlY3Rpb24gbm90IGluKCckc2V4Y2x1
ZGUnKSI7CgoJCQkJJGNleGNsdWRlID0gZG9fbGlzdCgkY2V4Y2x1ZGUpOwoJCQkJJGNleGNs
dWRlID0gam9pbigiJywnIiwgZG9TbGFzaCgkY2V4Y2x1ZGUpKTsKCQkJCSRjZXhjbHVkZSA9
ICJhbmQgKHRleHRwYXR0ZXJuLkNhdGVnb3J5MSBub3QgaW4oJyRjZXhjbHVkZScpIE9SIHRl
eHRwYXR0ZXJuLkNhdGVnb3J5MiBub3QgaW4oJyRjZXhjbHVkZScpKSI7CgkJfQoJCWlmICgk
aWRleGNsdWRlKXsKCQkJCSRpZGV4Y2x1ZGUgPSBkb19saXN0KCRpZGV4Y2x1ZGUpOwoJCQkJ
JGlkZXhjbHVkZSA9IGpvaW4oIicsJyIsIGRvU2xhc2goJGlkZXhjbHVkZSkpOwoJCQkJJGlk
ZXhjbHVkZSA9ICJhbmQgdGV4dHBhdHRlcm4uSUQgbm90IGluKCckaWRleGNsdWRlJykiOwoK
CQl9CglpZihlbXB0eSgkc2VjdGlvbnMpICYmIGVtcHR5KCRjYXRlZ29yaWVzKSAmJiBlbXB0
eSgkc2V4Y2x1ZGUpICYmIGVtcHR5KCRjZXhjbHVkZSkgJiYgZW1wdHkoJGlkZXhjbHVkZSkp
ewoJCSRycyA9IHNhZmVfcm93c19zdGFydCgnKicsICd0eHBfZGlzY3VzcycsCgkJCSJ2aXNp
YmxlID0gIi5WSVNJQkxFLiIgb3JkZXIgYnkgJHNvcnQgbGltaXQgMCwkbGltaXQiKTsKCgl9
CgllbHNlewoJCSRycyA9IHNhZmVfcm93c19zdGFydCgndHhwX2Rpc2N1c3MuKiwgdGV4dHBh
dHRlcm4uU2VjdGlvbiwgdGV4dHBhdHRlcm4uQ2F0ZWdvcnkxLCB0ZXh0cGF0dGVybi5DYXRl
Z29yeTInLCAndHhwX2Rpc2N1c3MsIHRleHRwYXR0ZXJuJywgInR4cF9kaXNjdXNzLnBhcmVu
dElEID0gdGV4dHBhdHRlcm4uSUQgQU5EIHZpc2libGUgPSAiLlZJU0lCTEUuIiAkc2luY2x1
ZGUgJGNpbmNsdWRlICRzZXhjbHVkZSAkY2V4Y2x1ZGUgJGlkZXhjbHVkZSBvcmRlciBieSAk
c29ydCBsaW1pdCAwLCRsaW1pdCIpOwoJfQoJfQoJKCRmb3JtICE9ICcnKSA/ICRmb3JtZWQg
PSBmZXRjaF9mb3JtKCRmb3JtKSA6ICcnOwoKCWlmICgkcnMpCgl7CgkJJG91dCA9IGFycmF5
KCk7CgoJCXdoaWxlICgkYyA9IG5leHRSb3coJHJzKSkKCQl7CgkJCSRhID0gc2FmZV9yb3co
JyosIElEIGFzIHRoaXNpZCwgdW5peF90aW1lc3RhbXAoUG9zdGVkKSBhcyBwb3N0ZWQnLAoJ
CQkJJ3RleHRwYXR0ZXJuJywgJ0lEID0gJy4kY1sncGFyZW50aWQnXSk7CgoJCQlpZiAoJGFb
J1N0YXR1cyddID49IDQpCgkJCXsKCQkJCWlmKCRmb3JtZWQpewoJCQkJCXBvcHVsYXRlQXJ0
aWNsZURhdGEoJGEpOwoJCQkJCSRHTE9CQUxTWyd0aGlzY29tbWVudCddID0gJGM7CgkJCQkJ
JG91dFtdID0gcGFyc2UoJGZvcm1lZCk7CgkJCQkJdW5zZXQoJEdMT0JBTFNbJ3RoaXNjb21t
ZW50J10pOwoJCQkJCXVuc2V0KCRHTE9CQUxTWyd0aGlzYXJ0aWNsZSddKTsKCQkJCX0KCQkJ
CWVsc2V7CgkJCQkJJG91dFtdID0gaHJlZigKCQkJCQkJJGNbJ25hbWUnXS4nICgnLmVzY2Fw
ZV90aXRsZSgkYVsnVGl0bGUnXSkuJyknLAoJCQkJCQlwZXJtbGlua3VybCgkYSkuJyNjJy4k
Y1snZGlzY3Vzc2lkJ10KCQkJCQkpOwoJCQkJfQoJCQl9CgkJfQoKCQkoIWVtcHR5KCRzbGFi
ZWwpICYmICFlbXB0eSgkcHJldGV4dFsncyddKSkgPyAkbGFiZWwgPSBwcmVnX3JlcGxhY2Uo
Jy9cJHMvJywgZmV0Y2hfc2VjdGlvbl90aXRsZSgkcHJldGV4dFsncyddKSwgJHNsYWJlbCkg
OiAkbGFiZWw7CgkJKCFlbXB0eSgkY2xhYmVsKSAmJiAhZW1wdHkoJHByZXRleHRbJ2MnXSkp
ID8gJGxhYmVsID0gcHJlZ19yZXBsYWNlKCcvXCRjLycsIGZldGNoX2NhdGVnb3J5X3RpdGxl
KCRwcmV0ZXh0WydjJ10pLCAkY2xhYmVsKSA6ICRsYWJlbDsKCgoJCWlmICgkb3V0KQoJCXsK
CQkJcmV0dXJuIGRvTGFiZWwoJGxhYmVsLCAkbGFiZWx0YWcpLmRvV3JhcCgkb3V0LCAkd3Jh
cHRhZywgJGJyZWFrLCAkY2xhc3MpOwoJCX0KCX0KCglyZXR1cm4gJyc7Cn0iO3M6MzoibWQ1
IjtzOjMyOiJmYzE5NjYyM2ZjNmFhZDk0ODY5MGIwMDcwMDE2ZGFkMyI7fQ==
